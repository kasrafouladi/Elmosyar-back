{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ú¯{% endblock %}

{% block extrastyle %}
<style>
    .log-files-container {
        padding: 20px;
    }
    
    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .stat-card h3 {
        margin: 0 0 10px 0;
        color: #666;
        font-size: 14px;
        font-weight: normal;
    }
    
    .stat-card .value {
        font-size: 28px;
        font-weight: bold;
        color: #417690;
    }
    
    .log-files-table {
        width: 100%;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .log-files-table table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .log-files-table th {
        background: #417690;
        color: white;
        padding: 12px;
        text-align: right;
        font-weight: bold;
    }
    
    .log-files-table td {
        padding: 12px;
        border-bottom: 1px solid #eee;
    }
    
    .log-files-table tr:hover {
        background: #f8f9fa;
    }
    
    .action-buttons {
        display: flex;
        gap: 8px;
    }
    
    .btn {
        padding: 6px 12px;
        border-radius: 4px;
        text-decoration: none;
        font-size: 13px;
        border: none;
        cursor: pointer;
        display: inline-block;
    }
    
    .btn-primary {
        background: #417690;
        color: white;
    }
    
    .btn-success {
        background: #28a745;
        color: white;
    }
    
    .btn-warning {
        background: #ffc107;
        color: #000;
    }
    
    .btn-danger {
        background: #dc3545;
        color: white;
    }
    
    .btn:hover {
        opacity: 0.9;
    }
    
    .preview-box {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        margin-top: 5px;
        max-height: 100px;
        overflow-y: auto;
    }
    
    .preview-line {
        margin: 2px 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Ø®Ø§Ù†Ù‡</a>
    &rsaquo; Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯â€ŒÙ‡Ø§
</div>
{% endblock %}

{% block content %}
<div class="log-files-container">
    <h1>ğŸ” Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ú¯</h1>
    
    <div class="stats-cards">
        <div class="stat-card">
            <h3>ØªØ¹Ø¯Ø§Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§</h3>
            <div class="value">{{ total_files }}</div>
        </div>
        <div class="stat-card">
            <h3>Ø­Ø¬Ù… Ú©Ù„</h3>
            <div class="value">{{ total_size }}</div>
        </div>
        <div class="stat-card">
            <h3>Ù…Ø³ÛŒØ± Ù„Ø§Ú¯â€ŒÙ‡Ø§</h3>
            <div class="value" style="font-size: 14px;">{{ log_dir }}</div>
        </div>
    </div>
    
    <div style="margin-bottom: 20px;">
        <a href="{% url 'admin:log_statistics' %}" class="btn btn-primary">
            ğŸ“Š Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ù…Ø§Ø± Ùˆ ØªØ­Ù„ÛŒÙ„
        </a>
    </div>
    
    <div class="log-files-table">
        <table>
            <thead>
                <tr>
                    <th>Ù†Ø§Ù… ÙØ§ÛŒÙ„</th>
                    <th>Ø­Ø¬Ù…</th>
                    <th>Ø¢Ø®Ø±ÛŒÙ† ØªØºÛŒÛŒØ±</th>
                    <th>Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´</th>
                    <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                </tr>
            </thead>
            <tbody>
                {% for file in log_files %}
                <tr>
                    <td><strong>{{ file.name }}</strong></td>
                    <td>{{ file.size_human }}</td>
                    <td>{{ file.modified|date:"Y-m-d H:i:s" }}</td>
                    <td>
                        {% if file.preview %}
                        <div class="preview-box">
                            {% for line in file.preview %}
                            <div class="preview-line">{{ line }}</div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a href="{% url 'admin:log_viewer' %}?file={{ file.name }}" 
                               class="btn btn-primary">
                                ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ù‡
                            </a>
                            <a href="{% url 'admin:log_download' %}?file={{ file.name }}" 
                               class="btn btn-success">
                                â¬‡ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯
                            </a>
                            <button onclick="clearLogFile('{{ file.name }}')" 
                                    class="btn btn-danger">
                                ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†
                            </button>
                        </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" style="text-align: center; padding: 40px;">
                        Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ Ù„Ø§Ú¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function clearLogFile(fileName) {
    if (!confirm(`Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ "${fileName}" Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ`)) {
        return;
    }
    
    fetch("{% url 'admin:log_clear' %}", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: `file=${fileName}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            location.reload();
        } else {
            alert('Ø®Ø·Ø§: ' + (data.error || 'Ø¹Ù…Ù„ÛŒØ§Øª Ù†Ø§Ù…ÙˆÙÙ‚'));
        }
    })
    .catch(error => {
        alert('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±');
        console.error(error);
    });
}
</script>
{% endblock %}
